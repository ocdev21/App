
#!/bin/bash

echo "Deploying L1 Troubleshooting Platform to l1-app namespace"
echo "========================================================="

# Create namespace first
echo "Creating namespace..."
oc apply -f namespace.yaml

# Deploy ClickHouse (data layer)
echo "Deploying ClickHouse..."
oc apply -f clickhouse-deployment.yaml

# Deploy Jupyter Notebook (analysis environment)
echo "Deploying Jupyter Notebook..."
oc apply -f jupyter-deployment.yaml

# Deploy ConfigMap and Secrets
echo "Deploying configuration..."
oc apply -f configmap.yaml

# Deploy L1 Troubleshooting Application
echo "Deploying L1 Application..."
oc apply -f deployment.yaml

# Deploy Services and Routes
echo "Deploying services..."
oc apply -f service.yaml

# Wait for deployments
echo "Waiting for deployments to be ready..."
oc rollout status deployment/clickhouse -n l1-app
oc rollout status deployment/jupyter-notebook -n l1-app
oc rollout status deployment/l1-troubleshooting -n l1-app

echo ""
echo "Deployment completed successfully!"
echo ""
echo "Access URLs:"
echo "============"
echo "L1 Troubleshooting App: $(oc get route l1-troubleshooting-route -n l1-app -o jsonpath='{.spec.host}')"
echo "Jupyter Notebook: $(oc get route jupyter-route -n l1-app -o jsonpath='{.spec.host}')/jupyter"
echo "ClickHouse HTTP: http://$(oc get service clickhouse-service -n l1-app -o jsonpath='{.spec.clusterIP}'):8123"
echo ""
echo "Jupyter Token: l1-analysis-token"
echo ""
echo "To check pod status:"
echo "oc get pods -n l1-app"
